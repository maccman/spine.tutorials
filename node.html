<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<title>Spine Tutorials</title>
<link rel="stylesheet" href="site/site.css" type="text/css" charset="utf-8">
<link rel="stylesheet" href="site/highlight.css" type="text/css" charset="utf-8">
<script src="site/jquery.js" type="text/javascript" charset="utf-8"></script>      
<script src="site/highlight.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
  hljs.initHighlightingOnLoad();
</script>
</head>
<body>
<div id="container"><div class="back"><a href="index.html">&laquo; Back to all tutorials</a></div>


<h1>Using Spine and NodeJS</h1>

<p><a href="http://nodejs.org/">NodeJS</a> is essentially a way of using Google's <a href="http://code.google.com/p/v8/">V8 JavaScript</a> engine for running JavaScript on the server side, taking advantage of its blazing speed and evented IO. Node provides a similar environment for scripts as in Google Chrome, with the exception of a DOM. Spine has special Node support, so everything that doesn't touch the DOM will work as usual, such as <code>Spine.Events</code>, <code>Spine.Class</code> and <code>Spine.Model</code>. The only component to Spine that won't work with NodeJS is <code>Spine.Controller</code>; as it relies on the DOM so even loading controllers will cause errors.</p>

<p>So why would you want to use Spine with Node? Well for a start Spine's classes and models are just as useful server side as they are client side - and you can use them to structure and modularize your code. More importantly though, it paves the way for code re-use between server and client. You could potentially use the same models, classes and libraries on both the client and server side. Finally, you can run automated unit-tests in Node, testing your client-side code.</p>

<p>You can install Spine using <a href="http://npmjs.org">npm</a>:</p>

<pre><code>npm install spine
</code></pre>

<p>Spine's API in Node is exactly the same, the one difference being you first need to fetch a reference to the library using <code>require()</code>.</p>

<pre><code>var Spine = require("spine");

var MyClass = Spine.Class.create({
  sameApi: "asUsual"
});
</code></pre>

<h1>Exports</h1>

<p>By default NodeJS encapsulates code preventing global scope pollution. If you want your client-side scripts to work with Node you'll have to explicitly expose any variables you want to be global. This is done by using the <code>exports</code> object, setting global variables as properties on it. To allow your scripts to run in either a server or client side environments, you can check to see if it exists, creating it if otherwise.</p>

<pre><code>(function(){
  // Set exports to global context unless defined
  if (typeof exports == "undefined")
    var exports = this;

  // Expose MyClass
  exports.MyClass = Spine.Class.create();
})();
</code></pre>

<h1>Testing with NodeJS &amp; Jasmine</h1>

<p>The <a href="https://github.com/mhevery/jasmine-node">jasmine-node</a> project is a great way of running <a href="http://github.com/pivotal/jasmine">Jasmine</a> tests with Node. First install the package using npm:</p>

<pre><code>npm install jasmine-node
</code></pre>

<p>Then you have a command line executable, <code>jasmine-node</code>, that can be used to run tests.</p>

<pre><code>jasmine-node specs
</code></pre>

<p>You'll need to pass as directory to <code>jasmine-node</code> containing all your specs. Additionally, your specs need to be named *.spec.js to be picked up properly. Any files named *.helper.js will be loaded in before the specs are executed.</p>

<p>For example, we can create a spec called <em>class.spec.js</em> to test Spine's classes.</p>

<pre><code>var Spine = require("spine");

describe("Class", function(){
  var User;

  beforeEach(function(){
    User = Spine.Class.create();
  });

  it("is sane", function(){
    expect(Spine).toBeTruthy();
  });

  it("can create subclasses", function(){
    User.extend({classProperty: true});

    var Friend = User.create();
    expect(Friend).toBeTruthy();
    expect(Friend.classProperty).toBeTruthy();
  });
});
</code></pre>

<p>And we can now run this spec using jasmine-node:</p>

<pre><code>$ jasmine-node spec/
  Started
  ..........

  Finished in 0.003 seconds
  1 test, 17 assertions, 0 failures
</code></pre>

<p>To find out more information about Jasmine's spec syntax, see <a href="http://github.com/pivotal/jasmine">its documentation</a>.</p>
</div>
</body>
</html>